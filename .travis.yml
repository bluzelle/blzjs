dist: bionic

language: node_js
node_js:
  - node

env:
  global:
    - secure: "mxKFdSXcxH3xHmb17YDTPT4a+EvyNhyT2KF/TrcsXUXPyVMCMnRTdljaVUqnUc0cF+uJA3e3XHIPvJOY678DBzUjXxN4x8HwrDNYBpKW/fZhi/vGUdW8M6Ue2gZ1qg3L/HBE59L60SBB2RuaLItiwD25r5SAwPjhFJ4F+eBEcSa00wFZeZQIHsPS87gxfnhmQfilaDeBpAa6wHXhnBAvR4Yl0izXymUN93TUMMS+zx0opjYvcTjynxNLZF5K3fMc1pSaInx7Qu8S5Dii4JlImertqvhTWhvcwptySKAO34iBA20LIVtCP5bVWXkDYSNgh4JI3KpL+OWFAnpmAkpH1IpWsTTNdfITBWtcvCb1ma/gZWXZ0vZci26grfLeyaih/vT0pIzyFSPhyRm3GF9FFVsePBHhHFRu9VyqF7htvtWz9CV1BvCVVQGx4W9mHiqqE9HAdRkz69SM7OtLAEUpgupxZH2tldgH5xg4Q+HvggfMoZ+ANPvOHqNgMVkWDHKXKr9rMOxPB729cIRqMBhQeA9M6DKdFI50jxhSmxL/REBaSPdB2QHCV91RSBFCu9Kd9hCF4LkJJVpZpBSHFqi/n7y7g7lIUTO8dDJ133Jo/EFh4kl7oTny/7PA4eEfxmM7gYl1Py2wIiMX8dgBigSAE7gQXvORDx2kGD+twBV30DY="
jobs:
  include:
    - stage: Produce Coverage
      node_js: node
      before_script:
        - sudo apt-get install ruby-dev && sudo gem install travis
        - npm install -g travis-status
        - npm install -g child_process
      script:
        - |
          ls -a
          echo ${TRAVIS_PULL_REQUEST}
          echo ${TRAV_API_TOKEN}
          if [ "${TRAVIS_PULL_REQUEST}" == "false"  ]; then 
            npx nyc --reporter=lcov mocha "**/tests/*_test.js" --timeout 20000 && cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js
          else 
            echo "y" | travis restart -r bluzelle/curium-test; 
            npm install travis-status; 
            node travisStatus.js $TRAV_API_TOKEN; 
          fi